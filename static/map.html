<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title></title>
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
  <script src='jquery-1.12.2.min.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />
  <style>
    body { margin:0; padding:0; }
    .map { position:absolute; top:0; bottom:0; width:100%; }
  </style>
</head>
<body>

<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />

<div id='map' class='map'> </div>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoicmF5bW9uZGphY29ic29uIiwiYSI6IlVlWnVITTQifQ.lzpdThXgyxuWTS2WQBTqVg';

var map = L.mapbox.map('map', 'mapbox.light')
  .setView([40.7587442, -73.9808623], 13);

var markers = new L.MarkerClusterGroup();

function addMarker(latlong, color) {
  var marker = L.marker(latlong, {
      icon: L.mapbox.marker.icon({
        'marker-color': color
      })
  });
  markers.addLayer(marker);
}

// $.getJSON("http://localhost:5000/existing", function(data) {
//   for (var i=0; i<data.length; ++i) {
//     addMarker(data[i], "#44c6f8");
//   }
// });

$.getJSON("http://localhost:5000/new", function(data) {
  for (var i=0; i<data.length; ++i) {
    addMarker(data[i], "#44c6f8");
  }
});

map.addLayer(markers);

</script>
</body>
</html>
